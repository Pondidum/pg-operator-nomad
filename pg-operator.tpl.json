{
  "ID": "pg-operator",
  "Name": "pg-operator",
  "TaskGroups": [
    {
      "Name": "operators",
      "Tasks": [
        {
          "Config": {
            "image": "ghcr.io/pondidum/pg-operator-nomad:latest",
            "network_mode": "host",
            "args": [
              "--verbose"
            ]
          },
          "Driver": "docker",
          "Env": {
            "VAULT_ADDR": "????????????????",
            "OTEL_EXPORTER_OTLP_ENDPOINT": "otlp://${attr.unique.network.ip-address}:4317",
            "OTEL_EXPORTER_OTLP_INSECURE": "true",
            "NOMAD_ADDR": "http://localhost:4646",
            "PGHOST": "???????????????",
            "PGDATABASE": "postgres"
          },
          "Name": "listener",
          "Templates": [
            {
              "ChangeMode": "restart",
              "DestPath": "secrets/pg.env",
              "EmbeddedTmpl": "{{ with secret \"database/creds/operator\" }}\nPGUSER=\"{{ .Data.username }}\"\nPGPASSWORD=\"{{ .Data.password }}\"\n{{ end }}\n",
              "Envvars": true
            }
          ],
          "Vault": {
            "Role": "pg-operator"
          }
        }
      ]
    }
  ]
}
